---
output:
  pdf_document: default
  html_document: default
---
# Table of Contents
* Vignette
* Part 1: Outlining your presentation
* Part 2: Refining your graphs
* Part 3: Informative labels
* Part 4: Adding more sites
* Part 5: Legends
* Part 6: Adding visual elements
* Part 7: Themes
* Part 8: Reviewing your plots

# Vignette

In the first part of this module, you explored data collected by K'avi tribal forestry managers on the total number of board feet for all Douglas Firs within a one acre area for four different sites. Based on data analysis and other qualitative factors, you decided which site would be the best for a timber harvest.

Based on your exploration of this timber data set in the first part of this module, it is time to present what you have learned to the broader community. You will create and present suggestions on the management of these forests to the community, using the data science tools you have developed throughout the semester. 

The goal of this lesson is to work on refining the graphs that you have been making throughout the course so that they are an effective tool for sharing what you have learned through your data analysis with the broader community. We will demonstrate each new graphing tool using a graph of the density of trees within a one acre plot versus the age of the one acre plot and then we will let you explore ways to use each technique on the plot of board feet versus age that you created at the end of day 1 of this module. 

--------------------------------------------------------------------------------
# WORKSHOP: Learning goals (More for us as a team, rather than for SKC students)

The goal of the second day of the forestry module is to have the students fully explore what creating and presenting recommendations for management based on data science means with a strong emphasis on how to best make and present graphs that are accessible and helpful for the general public. 

[#JMc: I think these goals are admirable, but, in practice, I think they end up a little at-odds in this module. On the one hand, students are encouraged to come up with their own questions and make their own plots. On the other hand, the datasets are limited (3 variables) and the code directs them to make specific plots (age vs tree_number). I would recommend backing off Goal 1 (creativity & freedom), in favor of Goal 2 (Answering a specific question and focusing on presenting this in a compelling way). We could end with a discussion of how these skills allow creativity and freedom going forward.]
--------------------------------------------------------------------------------

# PART 1: Outlining your presentation

**Class Questions**

**What do you want to present?**
  What are the variables that you have been working with? Why are these variables relevant to the goal of choosing a site to start a timber harvest site on? 

  In an effort to keep things simple, we have only been working with the yield of a specific site over time but in reality yield is far from the only variable that is relevant when picking out a site for a new timber harvest site. What other things would you want to consider when picking a new site for timber harvest? 

**Who do you want to present it to?**
  Who might you be presenting this information to? What type of background do they have in picking a site for timber harvest? 
  
  Why would this audience be interested in hearing about the productivity of different sites? 
  
**Setting goals for your plot**

  Based on the other factors that are important for picking a timber harvest site that you identified in the first part of this question and the audience you identified in the second part of the question, what role do you think information on board feet versus the age of a forest stand would play in this presentation? 
  
  How would a graph of board feet versus stand age help to achieve that role? What important characteristics should this graph have so that it fills the role you want it to have? 
  
Now that you have an idea of what your goals are for this graph, we will present a couple different tools in ggplot to give you more control over your graphs. With each tool, we will show show one way you can use that tool on a graph of tree density versus stand age and then we will point you towards resources you can use to explore how to implement that tool with your own graphs. 

# PART 2: Refining your graphs

```{r}
# Cleaning environment and setting working directory
rm(list = ls())
current_path = rstudioapi::getActiveDocumentContext()$path
setwd(dirname(current_path))
set.seed(1)

# Load libraries
library(tidyverse)

# Read in and reformat data - We are loading in the data again because we cleared all the data out of R above so that we could start with a clean slate. 
site_1 <- read.csv("site_1.csv") %>% 
  mutate(site_ID = 1)
site_2 <- read.csv("site_2.csv") %>% 
  mutate(site_ID = 2)
site_3 <- read.csv("site_3.csv") %>% 
  mutate(site_ID = 3)
site_4 <- read.csv("site_4.csv") %>% 
  mutate(site_ID = 4)
forest<- rbind(site_1, site_2, site_3, site_4)
```

The first part of making an effective graph is picking what kind of graph you want to make. We have generally been using scatterplots *and ____* throughout this course but ggplot offers a wide variety of different plot types for you to play with. Generally the first step for picking a plot type is determining how many variables you are trying to represent and what your goal for the plot is. 

In our example of the number of trees over time at site 1 we have two different variables, time and number of trees. Both time and number of trees are continuously changing variables (not groups) so we would choose either a scatterplot or a line plot to represent them. 

Here is an example of a scatterplot:
```{r, satter plot}
ggplot(site_1, aes(x = age, y = tree_number))+
  geom_point()
```
Here is a line plot:

```{r, line plot}
ggplot(site_1, aes(x = age, y = tree_number))+
  geom_line()
```

In this case the scatterplot focuses on the number of trees at each time point whereas the line plot focuses more on the overall trend in trees over time.

**Class Questions**

* Which of these do you think is more important for your presentation on yield over time at this site?
* What story do you want to tell with these graphs? 

You can plot whichever plot you decide on here:

```{r}

```


Another cool thing that ggplot lets us do is layer different plots on top of one another. Using this we can show both the scatterplot and the line plot. 

```{r}
ggplot(site_1, aes(x = age, y = tree_number))+
  geom_line()+
  geom_point()
```

Try it out with your plot here:

```{r}

```

**Class Questions**

Now that you have created a basic plot that technically has all of the information in it, if you could change anything about the graph what would you change about it to better fit the audience you identified in part 1? 

[#JMc: Since a big focus of this Day is graphis, it might be useful to provide some principles or guidance on these choices.] [Here's a reference I use](https://socviz.co/lookatdata.html#what-makes-bad-figures-bad), though it's quite opinionated. Maybe just ask them which principles are important for conveying meaning in data?]


# PART 3: Informative Labels

One of the first things we can do to make the graph more interpretable is change the text on the graph so that it is meaningful and helpful. 
We can do this using the labs() layer in ggplot. To add this layer all you need to do is add a plus sign at the end of the last layer (geom_point or geom_line) and then add the labs layer in the next line. You can type ?labs in the Console to learn about all the different things you can do in this layer but basically, it lets you add a title or caption, change the axis labels, etc. 
In the following plot we have changed the axis labels and added a title:

[#JMc: Note that in the knit pdf from this document, the titles get cut off when the graphs are plotted side-by-side with patchwork.]

```{r, labels}
ggplot(data = site_1, aes(x = age, y = tree_number))+
  geom_point()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Site 1")
#The labs function allows you to adjust the labels of many different aspects of
#the graph simultaneously. Caption allows you to add a caption to the graph, 
#while x and y adjust the names of the axes respectively. Finally, title allows
#you to rename the title of the graph and subtitle to add extra information.
```
While you add labels to your graph below, think about the data that you are trying to convey to your chosen audience. How much background information/context will be useful to include on the graph that you are presenting to them? Will they know the units of the axes?

```{r}

```


Take a look at the graph below. What are the differences between it and the one above?
```{r, adding labels}
#Calls the function ggplot (we have seen this before), adds which data frame
#the graph is taking information from, and assigns a variable to the x and y axes
ggplot(forest, aes(x = age, y = board_feet))+
#This tells ggplot what kind of graph to create (a scatter plot), in the
#aesthetics of the graph we can tell R to differentiate each site by a different color
  geom_point(aes(color = as.factor(site_ID)))+
#The labs function allows you to adjust the labels of many different aspects of
#the graph simultaneously. Caption allows you to add a caption to the graph, 
#while x and y adjust the names of the axes respectively. Finally, title allows
#you to rename the title of the graph and subtitle to add extra information.
  labs(caption = "Board Feet vs. Age of Sites 1-4 of the K'avi Forest Data",
       x="Age (Years)", y="Board Feet", title="Board Feet vs. Age per Site", 
       subtitle="Subtitle for this graph")
```

# PART 4: Adding more sites

*This may need to be substantially edited depending on what previous lessons covered*

Now that we have a plot that describes the trends at one site we can add in the information from the other sites. There are two main ways to do this, either by creating a different plot for each site and then arranging the plots next to one another, or adding all the sites to one plot. 

First we will show you how to arrange multiple different plots side by side using the package patchwork. The first thing to do is download and then load the package itself. 

```{r}
# If you do not already have patchwork downloaded on your computer, delete the # in the next line to uncomment that code and then run the following line to download the package: 
#install.packages(patchwork)

# Loading the package into this session of R
library(patchwork)
```
To use patchwork you need to create graphs for each of the sites, and then save each graph as its own variable the same way you would for any other variable. 

```{r, creating the graphs at each site}
site_1_plot <- ggplot(data = site_1, aes(x = age, y = tree_number))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Site 1")

site_2_plot <- ggplot(data = site_2, aes(x = age, y = tree_number))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Site 2")

site_3_plot <- ggplot(data = site_3, aes(x = age, y = tree_number))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Site 3")

site_4_plot <- ggplot(data = site_4, aes(x = age, y = tree_number))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Site 4")
```

Then, to arrange the the graphs you can use + and / with the plots you saved above. There are a couple of examples below but you can see all the different ways to use this package to arrange graphs here: https://patchwork.data-imaginist.com/

```{r, combining the plots}
# + puts the two graphs next to one another
site_1_plot + site_2_plot

# / Puts the graphs on top of one another
site_1_plot / site_2_plot

# Then you can get fancy with it!
(site_1_plot + site_2_plot) / site_3_plot

```
Experiment with patchwork with your own graphs below until you find an arrangement you like. 

```{r}

```

The second way to show data from multiple sites is to put all of the sites on one graph. We can do this in the aes() portion of the ggplot function by telling R to represent which site a point is from with another aspect of the graph. In our example we will use the color of the points and lines.

```{r}
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID))+
  geom_point()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site")
```
Note in this graph that the scale for the color on the right hand side of the plot is a continuous gradient of color rather than individual colors. This is because when we set up the site ID during the last lesson we set the ID of each site as a number. When we input a variable as a number, R automatically assumes that variable is a continuous, numerical variable. Since we are using the site ID as different categories for which site each observation is from we need this variable to be a factor (or categorical) variable rather than a number which we can do with the following code.

```{r}
forest$site_ID <- as.factor(forest$site_ID)
```

Now we can use the exact same code as above and it will color the points in different/discrete colors for each site rather than a gradient. We can also add back in the lines which were removed in the previous point because the line plots do not work well with the previous color scale.

```{r}
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site")
```
Try adding all the sites onto your graph here:

```{r}

```


Both of these methods, arranging multiple graphs and adding colors, will show information on how the sites differ but they each have different pros and cons. In the arranged plots, each individual plot is cleaner and simpler whereas there is a lot going on in the combined plot. However, the combined plot lets you see the differences between sites more clearly and it takes up less space in a slide or a paper. 

**Class Questions:**

*Which format do you think will best convey the information to your proposed audience? Why? 

While both options have merits, the combined plot with different colors lets us more easily address the other topics we want to cover so moving forward in this lesson we will be referring back to the combined, color coded graph. 

# PART 5: Legends

You may have noticed in the previous section that when you added color categories for different sites, ggplot automatically created a legend. This legend on the right hand side of the plot describes what each color means. However, like many things ggplot automatically generates, the legend is not particularly reader-friendly. 

**Class Questions:**

* What would you like to change about your legend to tailor it to your specific audience?

Here are a couple of resources about how to change your legend in ggplot. They all cover similar things but you may prefer one over the others:

* http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/
* https://www.datanovia.com/en/blog/ggplot-legend-title-position-and-labels/
* http://www.sthda.com/english/wiki/ggplot2-legend-easy-steps-to-change-the-position-and-the-appearance-of-a-graph-legend-in-r-software 

Using one of the resources provided above or another resource that you prefer, change one thing about your legend that you have identified to make it more accessible to your audience. 

```{r, changing the legend}

```


# PART 6: Adding visual elements

Now that you have a plot with multiple site, different colors, and a legend it's time to give you more control over what those colors are and other ways to show groupings. 

To manually set what colors your plot you can use layer scale_color_manual() which will let you individually choose each color in your plot (example below). The resources below will provide you with a list of all the colors that R automatically knows the names of. You can also use the function colors() to get a list of all 657 colors that R knows the name of but that does not actually show the color along with the name. 

Colors:
* https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/
* http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf
* https://r-graph-gallery.com/42-colors-names.html

```{r}
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site", color = "Site")+
  scale_color_manual(values = c("dodgerblue4", "skyblue3", "steelblue1", "navyblue"))
```
Note that the number of colors you give R must equal the number of categories you have. Change the color in your plot here:

```{r, changing the colors}

```

It is also important to note here that displaying important information with different colors in your plot can make reading your plots hard for colorblind people. There are a couple of different ways to help with this including, picking a color palette that is colorblind friendly or using a couple of different methods to distinguish the different groups. 

There is a package in R that specifically has color-blind friendly palettes that you can use in your graphs. It is called viridis and here are some examples of it.


```{r}
# Uncomment this and run it to initially install the package
#install.packages("viridis")

# Loading the package into this session of R. 
library(viridis)
```

Now lets try it on our graph

```{r}
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID))+
  geom_point()+
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site", color = "Site")+
#Viridis automatically defaults to a continuous color scale, but since we have a 
#discrete number of sites with a discrete number of colors, we have to add
#discrete = TRUE
  scale_color_viridis(discrete = TRUE)
```

Try it out on your own graphs

```{r}

```

Another options for making graphs more accessible for color-blind people is by using multiple kinds of visual cues to separate different groups. This can look different for different kinds of plots so here are examples of what this would look like for scatterplots and line plots. 

In scatterplots we can change the shapes of the points. 
```{r}
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID, shape = site_ID))+
#We can use size to make the points larger and easier to see. Larger numbers make
#the points larger on the graph 
  geom_point(size = 4)+ 
  geom_line()+
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site", color = "Site", shape = "Site")+
  scale_color_viridis(discrete = TRUE)

```
With line plots we can change the line types. 

```{r}
#Here we can make each site have a different color and a different type of line 
#by assigning them by site_ID
ggplot(data = forest, aes(x = age, y = tree_number, color = site_ID, linetype = site_ID))+
  geom_point()+  
#Again we can use the size command to increase the width of the lines
  geom_line(size = 3)+ 
  labs(x = "Site Age", y = "Number of Trees", title = "Number of Trees Over Time at Each Site", color = "Site", linetype = "Site")+
  scale_color_viridis(discrete = TRUE)
```
Which of these options do you think is best for your audience?

# PART 7: Themes

*Talking about themes may be a stretch goal/not the most important part of this exercise. How do we feel about leaving this out?*

[#JMc: There's a lot more they could do on graphics, of course, so we'll have to draw the line somewhere. Maybe suggest it as one "Future directions option." Just point them in this direction, perhaps under the "More Resources" section at the end?]

* Basic themes
```{r}
#This allows you to adjust finer details of the graph. For instance, you can 
#adjust the size and color of the title and subtitle. 
  theme(plot.title = element_text(size= "20", color="blue"), plot.subtitle = element_text(size = "10", color="purple"))
```

* Ways to make complicated themes

# PART 8: Reviewing your plots

Go back to the beginning of this document and look back at what you identified as the key takeaways from the data analysis. Take this as a chance to reflect on if your choice of graph is the best for summarizing this information

Review how you identified your audience. Do the added graph elements that you chose to add benefit this audience? If you could improve the graph in some way, how would you? (even if you don't know how to code this yet)
