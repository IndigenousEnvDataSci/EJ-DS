---
title: "Bison"
date: "2023-11-15"
output: html_document
---
### Figuring out a general workflow for this module
1) setwd, all of the same beginning stuff as usual. Don't even put the space for that, they should know to do that by now, but can maybe leave a small reminder.
2) Looking at all of the data: Biomass data and then maybe also a data frame that just has the size information of the different sites (in acres)
3) group in dplyr "group_by" so that they can get data for each site
4) Ask them to find the average biomass at each site (how to get summary statistics of groups)
5) Convert biomass units to match with acre units: Using mutate to make a new column that is a math function of existing column
6) Ask them to calculate the average biomass/acre at each site
7) Ask them to calculate the estimated total biomass at each site (avg biomass/acre * total acres)
8) Ask them to figure out if/which sites can support a viable Bison population (which will be described)
9) Ask them to figure out how many Bison each site can support in total
10) Ask them to think about, discuss, and explain the action that they would recommend to the K'avi community takes for Bison reintroduction: should entire bison population go to just one site, split amongst multiple sites, no sites at all? 
11) Ask them to make plots that can effectively communicate their decision.

Other considerations for this module, particularly in regards to a second day for this module: 
Include tibbles in here somewhere? Need to look more into tibbles and how they can be useful in this context!
  Potentially having them do this within the context of open-range Bison, where there are not any fences and they are only dealing with a single site. That could be what they do for the first day, and then do the work with three sites on the second day?
  
  Could also add the dimension of biomass varying seasonally, or year to year, or under threats like climate change. Can these sites support a Bison herd during the winter, when biomass is lower and nutrients are less available?
          For this, could have a second "winter" dataset, and maybe ask them to merge the two datasets, but also make a new column with the variable "summer" or "winter" that corresponds to the season the data was collected. 
          
  Could ~maybe~ bring in demography of bison and having them build population dynamics model of the bison to further see what the viable population is, how maximum bison from biomass may actually be different from their actual carrying capacity, etc. This would really only be for the students more proficient in R that are looking for an extra challenge, but could be useful more generally if the students are wondering about some of these topics as they pursue their own research questions for this module. Would require a lot of additional work though, which may not be feasible given the amount of remaining time in the semester.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Set your working directory and load in tidyverse
```{r set wd}
current_path = rstudioapi::getActiveDocumentContext()$path #For editing purposes! Students would have to do this step on their own
setwd(dirname(current_path))
```
## R Markdown

For many years, the K'Avi tribe has had cattle grazing pastures throughout their land.
Cattle have been a useful agricultural resource, but they are not native to the K'Avi's
region. In the past year, tribal agriculture managers have noticed a decreased vitality 
in many of their grazing lands causing less regrowth and a decrease in native plant species.
This is most likely due to the cattle, as they are non-specific grazers and are a non-native
species. Tribal agriculture managers are considering reintroducing bison to the lands for
both ecological and cultural reasons. Bison are native to this region and have been observed
to increase native grass species richness by 103% in comparison to cattle! The managers are
hoping to repurpose the cattle grazing lands to become bison grazing lands to encourage a
more sustainable agricultural practice for the region and to ensure the preservation of the
native grasslands.

To reintroduce bison, the land must have enough available sustenance for the bison to graze
and maintain a healthy lifestyle. The tribal agriculture managers are considering
several sites for reintroduction and have received a dataset with the annual plant biomass at each
site. The data available will help determine which sites are viable for bison reintroduction!

```{r set wd}
current_path = rstudioapi::getActiveDocumentContext()$path
setwd(dirname(current_path))
```
#Load in tidyverse
```{r tidy}
library(tidyverse)
```

##Load in Biomass Data and Site Datasets
```{r}
biomass <- read.csv("Bison_Mod3/biomass.csv", header = TRUE, sep = ',') #this is for our purposes, this would not be written for students in this module
sites <- read.csv("bison_sites.csv", header = TRUE, sep = ',')
```
**Maybe also load in the size of each site dataset in here too, just so they already have it**

#Look at all of the data

*Evan: Maybe ask them to get the average biomass / quadrat at each site? Depending on what they learn in Module 2, they should already know generally how to get stats for multiple sites, so they may not need to have group_by explained to them. Consult with Mod2*
Prompt that explains how in this module, they will be treating multiple sites differently from how they did in Module 2, and not creating a separate column for each of them.
Introducing the code group_by, so that they can group by the site without having to make separate columns for each site. 
#Group_by in dplyr
```{r group by}
dplyr::group_by(biomass, Site)
```
They will need to do this again after they convert the units, but this first time is the "we do" portion. 

**so these are tibbles, but we're not using them like a tibble, which would be like a dataframe but we can rename the columns? so i'm not sure how useful explaining a tibble is here unless we're explicitly telling them how to convert the data into a tibble format we can manipulate? since we're in tidyverse, it basically automatically becomes a tibble instead of a dataframe**
These tables we produce are called "tibbles" in tidyverse. They are another, simpler way to view the data. In the top left corner of each tibble, the dimensions are given to you. We can make any dataset into a tibble by using as_tibble. When you make a dataset into a tibble, you can name the columns with non-standard names (they don't have to have underscores connecting words) which makes a for a cleaner presentation.

****Maybe also explain what a "tibble" is!****** (Do you think you would be able to do this, Gabi?)

The quadrats are basically samples of the plant biomass, which can roughly tell us the amount of nutrients and calories available for bison and other herbivores, at each site. It is not feasible to collect this data for the entire site, so we have to take samples that can give us a general idea of the biomass of the entire site.

This dataset doesn't quite give the information the tribal agriculture managers are looking
for. Since there are multiple quadrants of data at each site, those are many small data points that can't tell the overall available biomass at each site.

####The big question####
What we have right now is the annual biomass in fifty 0.25 square meter quadrats at each site. How can we turn these fifty values into an estimate of the total biomass at each site?

Using group_by and summary to get the average biomass/quadrat at each site
```{r group and summary}
biomass %>%
  group_by(Site) %>% 
  summarise(avg_biomass=mean(Biomass))
```
What site has the most biomass per quadrat? What might this tell us about the viability of these sites for bison reintroduction?

We take the average biomass at each site because due to the large size of the sites, it would be impossible to get an actual total biomass of each site. This average gives us an idea of the average biomass in each of the 50 quadrants where data was taken. This data is currently in g/m^2, but the site area data has been given in different units--kilograms per hectare (kg/ha). (**Hectare is landscape scale**)

What's the problem with having data in two different units? What should we change the units to?


#Converting the units#
All of the unit conversions that need to happen: 
  currently in g/0.25 m2 and want to get to kg/ha 
  Conversion of g/0.25 m2 to kg/acre is * 40
Need to make a new column with the converted units
```{r}
  biomass2<- mutate(biomass, kg_ha = Biomass * 40)
print(biomass2)
#check that this works, need to also update this conversion to kg_hectare or kg_km2
```
This new dataset--biomass2-- now has a new column that converts the biomass in g/m^2 into kg/ha. The column "kg_ha" will be the new column we will call when we are looking at the biomass data because its now in the correct units!

We should take the average biomass per quadrant again, but this time with the converted units.
```{r new average with right units}
biomass_avg<- biomass2 %>%
  group_by(Site) %>% 
  summarise(avg_biomass=mean(kg_ha))
print(biomass_avg)
```

There is another dataset the tribal agriculture managers have with the sizes of each site in hectares. We are going to merge these two datasets into one.

```{r join}
Site_biomass <- left_join(sites, biomass_avg, by = "Site")
print (Site_biomass)
```
How does merging the datasets help us see the data?

What can this new tibble tell us about the quantity of biomass in each site?

With just this tibble, do you have a hypothesis of which site might be most suitable to reintroduce bison?


To get a rough estimate of the total available biomass in each site we should multiply the average biomass per quadrat (kg/ha) by the hectares of each site (ha). This will give us a total kg of biomass per site. This should be added as a new column to the site_biomass tibble.

```{r}
total_available <- Site_biomass %>%
  group_by(Site) %>%
  summarise(total_biomass= Acres*avg_biomass)
print (total_available)
```
What can these totals tell us about each site? Which site do you think is best suited for bison reintroduction? Why?

**ask them to visualize this**

Bison eat a lot of plants! One bison needs about 21,900 kg of biomass a year to live a healthy life. Since we have the total kg of biomass for each site now, we have an idea of which site might be best to introduce the bison. Bison are social animals and live in herds. It is important to the tribal agriculture managers to ensure that they can sustain a full herd population which would be between X and X bison. How many bison can each of these sites maintain?

```{r maximum bison}
mutate (total_available, max_bison=total_biomass/21900)
```
Which site(s) would be able to maintain a healthy bison population? 

Is there another way to show which site might be best? (not sure if we plan on making them graph this day)


```
This would be where I give them the example for the mutate function, but then have them do it on their own to relate it to Bison, and to get the total biomass at each site. The code written below is for our purposes, which they will have to make on their own most likely:
#Merging this tibble with the sites dataset, with the common column "Site". Using the code left_join, along with explanation of what it is! Might even just ask them to figure out how to do this using the dplyr cheatsheet. 

```{r join}
Site_biomass <- left_join(sites, biomass2, by = "Site")
```


```{r total biomass at each site}
bison_sites <- mutate(Site_biomass, Total_Biomass = Acres * kg_ha)
print (bison_sites)
```

#Dividing that by the amount needed per bison to get total number of bison (TBD)
```{r}
mutate(Bison_Sites, Max_Bison = Total_Biomass / ___)
```



```
***Day 2***

From last class, we have multiple sites that have enough biomass to sustain a healthy bison population! This is great, but upon further investigation, tribal agriculture managers realize that while the physical amount of biomass might be enough, they didn't take into consideration the quality of the forage. Since bison are generalist foragers, they'll eat almost anything, but they need to make sure that they consume 73,000 g/m^2 of nitrogen a year. Luckily, the tribal agriculture managers have another dataset that has the nitrogen content per quadrat at each site. 

import N dataset
```{r import N dataset}

```

Since the data is given in quadrats again, how would we find the total amount of nitrogen available for the bison?
```{r total N}
avg_nitrogen <- nitrogen %>%
  group_by (Site) %>%
  summarise (n_avg=mean(nitrogen))

avgN_per_site <- left_join(sites, avg_nitrogen, by "Site")

total_N <- avgN_per_site %>%
  group_by(Site)%>%
  summarise(total_n_available= Acres* avg_nitrogen)

mutate(total_N, new_max=total_n_available/73000)
  #insert code to get to the total N when given (ha) already
```
Does this change your decision for which site would be best for reintroduction?

Even though there might be several sites with enough biomass to support a large herd of
bison, it is not plausible that the bison will eat 100% of the forage available. There are
elk populations present in the prairies that must be accounted for to ensure that both
groups have enough biomass to sustain their populations.The present elk population must be
able to coexist with the reintroduced bison population. Elk require 2,158 kg/year of plant
biomass and 13,140 g/m^2 a year of N to live a healthy lifestyle.

1) import elk dataset
```{r import elk data}

```

2) each site has x, y, z of elk
  - multiply number of elk by kg
```{r kg biomass for elk}

```

3) subtract from total biomass of site
```{r subtracts from total biomass}

```

4) graph biomass per site
```{r bargraph of new available biomass}
library(ggplot2)
ggplot(new_total_biomass, mapping= aes(x=Site))+
  geom_bar(fill=green)
```

5) divide new biomass by bison to get new population #
  - does this change the best site for reintroduction?
```{r new bison #}
mutate (new_total_biomass, new_max_bison=new_total_biomass/21900)
```

**do again with N?**

