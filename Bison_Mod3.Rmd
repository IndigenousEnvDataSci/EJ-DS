---
title: "Bison"
date: "2023-11-15"
output: html_document
---

**Questions I have: Each site is not the same size, so the size of the quadrants varies per site?**
**Maybe I'm thinking too hard about this, but I thought all the quadrants would be a standard size so that a total of them would be a total of the biomass in the site?**
**But then if each site has 50 quadrants, that makes all of the sites the same size, which wouldn't make sense for the story. I can't remember how we said we were going to incorporate the different site sizes, so I might have made some changes that don't follow that workflow.**
**Why did you have them finding the average of the biomass instead of the total?**
**Does the nitrogen story make sense for a day 2? I think it might be a better route to get some data visualization in there and some practice of graphing multiple sites like in Mod 2**
### Figuring out a general workflow for this module
1) setwd, all of the same beginning stuff as usual. Don't even put the space for that, they should know to do that by now, but can maybe leave a small reminder.
2) Looking at all of the data: Biomass data and then maybe also a data frame that just has the size information of the different sites (in acres)
3) group in dplyr "group_by" so that they can get data for each site
4) Ask them to find the average biomass at each site (how to get summary statistics of groups)
5) Convert biomass units to match with acre units: Using mutate to make a new column that is a math function of existing column
6) Ask them to calculate the average biomass/acre at each site
7) Ask them to calculate the estimated total biomass at each site (avg biomass/acre * total acres)
8) Ask them to figure out if/which sites can support a viable Bison population (which will be described)
9) Ask them to figure out how many Bison each site can support in total
10) Ask them to think about, discuss, and explain the action that they would recommend to the K'avi community takes for Bison reintroduction: should entire bison population go to just one site, split amongst multiple sites, no sites at all? 
11) Ask them to make plots that can effectively communicate their decision.

Other considerations for this module, particularly in regards to a second day for this module: 
Include tibbles in here somewhere? Need to look more into tibbles and how they can be useful in this context!
  Potentially having them do this within the context of open-range Bison, where there are not any fences and they are only dealing with a single site. That could be what they do for the first day, and then do the work with three sites on the second day?
  
  Could also add the dimension of biomass varying seasonally, or year to year, or under threats like climate change. Can these sites support a Bison herd during the winter, when biomass is lower and nutrients are less available?
          For this, could have a second "winter" dataset, and maybe ask them to merge the two datasets, but also make a new column with the variable "summer" or "winter" that corresponds to the season the data was collected. 
          
  Could ~maybe~ bring in demography of bison and having them build population dynamics model of the bison to further see what the viable population is, how maximum bison from biomass may actually be different from their actual carrying capacity, etc. This would really only be for the students more proficient in R that are looking for an extra challenge, but could be useful more generally if the students are wondering about some of these topics as they pursue their own research questions for this module. Would require a lot of additional work though, which may not be feasible given the amount of remaining time in the semester.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Set your working directory and load in tidyverse
```{r set wd}
current_path = rstudioapi::getActiveDocumentContext()$path #For editing purposes! Students would have to do this step on their own
setwd(dirname(current_path))
```
## R Markdown

For many years, the K'Avi tribe has had cattle grazing pastures throughout their land.
Cattle have been a useful agricultural resource, but they are not native to the K'Avi's
region. In the past year, tribal agriculture managers have noticed a decreased vitality 
in many of their grazing lands causing less regrowth and a decrease in native plant species.
This is most likely due to the cattle, as they are non-specific grazers and are a non-native
species. Tribal agriculture managers are considering reintroducing bison to the lands for
both ecological and cultural reasons. Bison are native to this region and have been observed
to increase native grass species richness by 103% in comparison to cattle! The managers are
hoping to repurpose the cattle grazing lands to become bison grazing lands to encourage a
more sustainable agricultural practice for the region and to ensure the preservation of the
native grasslands.

To reintroduce bison, the land must have enough available sustenance for the bison to graze
and maintain a healthy lifestyle. The tribal agriculture managers are considering
several sites for reintroduction and have received a dataset with the annual plant biomass at each
site. The data available will help determine which sites are viable for bison reintroduction!

```{r set wd}
current_path = rstudioapi::getActiveDocumentContext()$path
setwd(dirname(current_path))
```
#Load in tidyverse
```{r tidy}
library(tidyverse)
```

##Load in Biomass Data and Site Datasets
```{r}
biomass <- read.csv("Bison_Mod3/biomass.csv", header = TRUE, sep = ',') #this is for our purposes, this would not be written for students in this module
sites <- read.csv("bison_sites.csv", header = TRUE, sep = ',')
```
**Maybe also load in the size of each site dataset in here too, just so they already have it**

#Look at all of the data

*Evan: Maybe ask them to get the average biomass / quadrat at each site? Depending on what they learn in Module 2, they should already know generally how to get stats for multiple sites, so they may not need to have group_by explained to them. Consult with Mod2*
Prompt that explains how in this module, they will be treating multiple sites differently from how they did in Module 2, and not creating a separate column for each of them.
Introducing the code group_by, so that they can group by the site without having to make separate columns for each site. 
#Group_by in dplyr
```{r group by}
dplyr::group_by(biomass, Site)
```
They will need to do this again after they convert the units, but this first time is the "we do" portion. 

**so these are tibbles, but we're not using them like a tibble, which would be like a dataframe but we can rename the columns? so i'm not sure how useful explaining a tibble is here unless we're explicitly telling them how to convert the data into a tibble format we can manipulate? since we're in tidyverse, it basically automatically becomes a tibble instead of a dataframe**
These tables we produce are called "tibbles" in tidyverse. They are another, simpler way to view the data. In the top left corner of each tibble, the dimensions are given to you. We can make any dataset into a tibble by using as_tibble. When you make a dataset into a tibble, you can name the columns with non-standard names (they don't have to have underscores connecting words) which makes a for a cleaner presentation.

****Maybe also explain what a "tibble" is!****** (Do you think you would be able to do this, Gabi?)

The quadrats are basically samples of the plant biomass, which can roughly tell us the amount of nutrients and calories available for bison and other herbivores, at each site. It is not feasible to collect this data for the entire site, so we have to take samples that can give us a general idea of the biomass of the entire site.

This dataset doesn't quite give the information the tribal agriculture managers are looking
for. Since there are multiple quadrants of data at each site, those are many small data points that can't tell the overall available biomass at each site.

####The big question####
What we have right now is the annual biomass in fifty 0.25 square meter quadrats at each site. How can we turn these fifty values into an estimate of the total biomass at each site?

**would this not be totaling the quadrats per site?**
```{r}
biomass %>%
  group_by(Site) %>%
  summarise(total_biomass=sum(Biomass))
#since we already used dplyr, we can use the group_by function to total the biomass at each site. We renamed the column to total_biomass and then took the sum of the biomass columnn per site
```
Now we have the total biomass at each site in g/m^2!

**i dont know if we need this bit**
Using group_by and summary to get the average biomass/quadrat at each site
```{r group and summary}
biomass %>%
  group_by(Site) %>% 
  summarise(avg=mean(Biomass))
```
Since we've found the average biomass at each site, it might be useful to include those in the data set to give a more clear idea of how much biomass is available at each site.
#Need to make a new column where those average values can go, right? Check on this

=======
**mention something about kg** The size of the sites have been given in hectares (ha). The totals we found have biomass in g/m^2, which can easily be converted to match the units of kg per ha. It is important to convert units so that they are standard across the dataset.

#Converting the units#
All of the unit conversions that need to happen: 
  currently in g/0.25 m2 and want to get to kg/ha (not tied to these specific units)
  Conversion of g/0.25 m2 to kg/ha is * 40
Need to make a new column with the converted units
```{r}
  biomass2<-mutate(biomass, annual_kg_ha = Biomass * 40)
print (biomass2)#check that this works
#show the tibble still
```
Now we've converted our biomass column into a new column called annual kg/ha, so that will be the new column we call on when looking at the biomass of the sites. We should take the total biomass again, but this time with the right units!

>>>>>>> Stashed changes

```{r total biomass with updated units}
biomass_total <-biomass2 %>%
  group_by(Site) %>% 
  summarise(total_kg=sum(annual_kg_ha))
print (biomass_total)
```
Since our biomass total is now in kg/ha we can find our how many bison each site can sustain. Bison eat a lot of plants! One bison needs about 21,900 kg of biomass a year to live a healthy life. To find how many bison can live in each site, we should make a new column that divides the total kg per site by the total kg a bison needs annually. 

```{r number of bison per site}
bison_per_site <- biomass_total %>%
  group_by (Site) %>%
  summarise (bison_per_site= total_kg/21900)
print (bison_per_site)
```
Which site would be the best suited to introduce buffalo to? Are there more than 1 that can sustain a population?

```

This would be where I give them the example for the mutate function, but then have them do it on their own to relate it to Bison, and to get the total biomass at each site. The code written below is for our purposes, which they will have to make on their own most likely:
#Merging this tibble with the sites dataset, with the common column "Site". Using the code left_join, along with explanation of what it is! Might even just ask them to figure out how to do this using the dplyr cheatsheet. 

```{r join}
Site_biomass <- left_join(sites, biomass_avg, by = "Site")
```


```{r total biomass at each site}
bison_sites <- mutate(Site_biomass, Total_Biomass = Acres * avg)
```

#Dividing that by the amount needed per bison to get total number of bison (TBD)
```{r}
mutate(Bison_Sites, Max_Bison = Total_Biomass / ___)
```






****** Day 2 ********

From last class, we have multiple sites that have enough biomass to sustain a healthy bison population! This is great, but upon further investigation, tribal agriculture managers realize that while the physical amount of biomass might be enough, they didn't take into consideration the quality of the forage. Since bison are generalist foragers, they'll eat almost anything but they need to make sure that they have 73,000 g/m^2 of nitrogen a year. Luckily, the tribal agriculture managers have another dataset that has the nitrogen content per quadrat at each site. 

**yada yada make them do the same things with the quality dataset--group_by, total nitrogen, mutate, unit conversion, etc**

Now that we have the nitogen content of these sites, it might be beneficial to visualize this data in some way to make it easier to communicate to the farmers who are hoping to implement the bison reintroduction.

```{r let them pick the graph}
#i would just do a bar graph of the nitrogen per site, but they could try a couple different based on the graphs they've seen in previous modules
```

